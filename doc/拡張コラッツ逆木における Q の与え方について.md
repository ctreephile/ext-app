拡張コラッツ逆木における Q の与え方について

拡張コラッツ予想の逆木を正しく構築するためには、ユーザーが与える Q の選び方が非常に重要です。
本稿では、なぜ Q が必要なのか、どのように選ぶべきか、実際の数値例を交えて丁寧に解説します。

1. なぜ Q が必要なのか？

オリジナルのコラッツ予想では、次の操作を繰り返します：

n が偶数 → n ÷ 2

n が奇数 → 3n + 1

逆木を作る場合は、あるノードの 前駆を求めたいわけです。
例えば、ノード 16 の前駆は：

偶数からの前駆: 16 ÷ 2 = 8

奇数からの前駆: (16 - 1) ÷ 3 = 5

ここで重要な点は、奇数側の計算は 3 で割り切れなければならないということです。
これを一般化したのが拡張コラッツ予想です。

2. 拡張コラッツ予想の基本

拡張コラッツでは、パラメータとして p と Q を用います：

p: 掛ける数（例：3, 4, 5 …）

Q: 長さ p−1 のリストで、各余りクラスに対応する値

操作は次の通りです：

n が偶数 → 2n（常に有効）

n が奇数（または、余り r ≡ n mod (p-1)） → (n - Q[r]) ÷ p が整数かつ正の奇数のときのみ有効

3. Q の与え方のルール
3.1 長さと添字

Q の長さは p-1 であること

添字 0 は None として空けておく
→ 余りクラス r=1..p-2 に対応する値を Q[1]～Q[p-2] に格納

例: p=4 の場合